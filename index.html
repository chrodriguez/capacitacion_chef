<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Chef</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" />

  <script type="text/javascript" src="./js/jquery-1.7.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  
    
      <script type="text/javascript" src="./js/sh_lang/sh_sh.min.js"></script>
    
      <script type="text/javascript" src="./js/sh_lang/sh_ruby.min.js"></script>
    
      <script type="text/javascript" src="./js/sh_lang/sh_json.min.js"></script>
    
  

  
    <link rel="stylesheet" href="./file/base.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
    <tr><td class="key">P</td><td>toggle pause</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none">
  <div class="content subsection center" ref="00-intro/01_index/1">
<p><img src="./file/00-intro/cocinando.png" alt="cocinando"/>

<h1>Opscode Chef</h1>

<div class="destacado"> Un curso de cocina para Administradores, Desarrolladores y DBAs </div>

<p><img src="./file/00-intro/logo.png" alt="logo">
<div class="destacado">
por Lic. Christian A. Rodriguez <a href="https://twitter.com/car_unlp">@car_unlp</a>
</div></img>

<div class="footer license">
<br/>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es"><img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png"/></a><br/><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Capacitaci&#xF3;n sobre Chef</span> por <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Christian A. Rodriguez</span> se encuentra bajo
una <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">Licencia Creative
Commons Atribuci&#xF3;n-CompartirIgual 3.0 Unported</a>.<br/>Basada en una obra en
<a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/chrodriguez/capacitacion_chef" rel="dct:source">https://github.com/chrodriguez/capacitacion_chef</a>.
</div>
</p>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets incremental" ref="00-intro/01_index/2">
<h1>Temas</h1>

<ul>
<li>Introducci&#xF3;n</li>
<li>Chef</li>
<li>Chef en producci&#xF3;n</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="00-intro/01_index/3">
<h1>Introducci&#xF3;n</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets incremental" ref="00-intro/01_index/4">
<h1>Introducci&#xF3;n</h1>

<ul>
<li>Los problemas</li>
<li>La b&#xFA;squeda de soluciones</li>
<li>DevOps</li>
<li>Productos que simplifican las tareas</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="00-intro/02_problemas/1">
<h1>Los Problemas</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/02_problemas/2">
<h1>Los problemas</h1>

<ul>
<li>Los problemas pueden verse desde:

<ul>
<li>La perspectiva de desarrollo</li>
<li>La perspectiva de soporte</li>
<li>La perspectiva de producci&#xF3;n</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/02_problemas/3">
<h1>Los problemas desde la visi&#xF3;n de desarrollo</h1>

<ul>
<li>Tenemos 94 proyectos, 58 est&#xE1;n con actividad</li>
<li>Versiones de productos todas las semanas</li>
<li>Por d&#xED;a se hacen alrededor de 5 deploys: 

<ul>
<li><em>Por errores en producci&#xF3;n</em></li>
<li><em>Por nuevas funcionalidades solicitadas</em></li>
</ul></li>
<li>Ambientes de trabajo:

<ul>
<li>Desarrollo</li>
<li>Pruebas</li>
<li><em>Preproducci&#xF3;n</em></li>
<li>Producci&#xF3;n</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert">
  <div class="content smbullets" ref="00-intro/02_problemas/4">
<h1>M&#xE1;s problemas desde la visi&#xF3;n de desarrollo</h1>

<ul>
<li>Ambientes complejos:

<ul>
<li><strong>SSO</strong> </li>
<li><strong>API</strong> </li>
<li><strong>Balanceo y cache</strong> </li>
</ul></li>
<li>Ejemplo con gr&#xE1;ficos:
<div class="small_images">
<img src="./file/00-intro/topologia-fisica.png" alt="Disposici&#xF3;n f&#xED;sica">
<img src="./file/00-intro/topologia-logica.png" alt="Disposici&#xF3;n l&#xF3;gica">
</img></img>
</div>
</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/02_problemas/5">
<h1>M&#xE1;s problemas desde la visi&#xF3;n de desarrollo</h1>

<ul>
<li>Conseguir elementos en producci&#xF3;n

<ul>
<li>Dumps en producci&#xF3;n</li>
<li>C&#xF3;digo en producci&#xF3;n</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/02_problemas/6">
<h1>Los problemas desde la visi&#xF3;n de soporte</h1>

<ul>
<li>Desarrollo no es el &#xFA;nico cliente</li>
<li>Se cumplen muchas otras tareas complejas</li>
<li>Los recursos de soporte deben configurar servicios o arquitecturas que no
definieron o desconocen 

<ul>
<li><em>API, desarrollos basados en Ruby, Erlang, NodeJS</em></li>
</ul></li>
<li>Seguridad comprometida al hostear aplicaciones propias o de terceros</li>
<li>Manejo de acceso a los servidores</li>
<li>Vencimientos de SSL</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/02_problemas/7">
<h1>Los problemas desde la visi&#xF3;n de producci&#xF3;n</h1>

<ul>
<li>Qu&#xE9; tener en cuenta para instalar nuevas aplicaciones</li>
<li>Qu&#xE9; hacer para actualizar una aplicaci&#xF3;n</li>
<li>C&#xF3;mo aplicar un parche en una base de datos grande que se encuentra en
producci&#xF3;n</li>
<li>Notificar a usuarios finales del servicio</li>
<li>P&#xE1;ginas de error ante problemas</li>
<li>Monitoreo y backup constante de los servicios</li>
<li>Vencimiento de los contratos</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="00-intro/03_soluciones/1">
<h1>Las soluciones</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets incremental" ref="00-intro/03_soluciones/2">
<h1>Las soluciones</h1>

<p>A partir de necesidades se fueron analizando soluciones. Muchas no nos llevaron
a nada, pero nos obligaron a juntarnos de forma interdisciplinaria y pensar en
posibles soluciones</p>

<ul>
<li>As&#xED; fueron apareciendo:

<ul>
<li>Virtualizacion</li>
<li>Matriz de aplicaciones por su seguridad y criticidad</li>
<li>Configuraciones de Apache con VHosts por usuario</li>
<li>Reglas de IPtables por usuario</li>
<li>Nuevos productos: nginx, openvz, varnish</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/03_soluciones/3">
<h1>Virtualizaci&#xF3;n</h1>

<ul>
<li><p>Nos ayud&#xF3; a:</p>

<ul>
<li>Simplificar el backup</li>
<li>Gesti&#xF3;n de equipos</li>
<li>Migrar en caliente</li>
<li>Aprovechar el espacio y recursos</li>
<li>Instalaci&#xF3;n de nuevas m&#xE1;quinas a partir de templates</li>
</ul></li>
<li><p>Nos complic&#xF3; en:</p>

<ul>
<li>Mantener las m&#xE1;quinas virtuales</li>
<li>El estado real de las virtuales</li>
<li>Sin storage no se tienen muchas funcionalidades interesantes</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/03_soluciones/4">
<h1>Matriz de aplicaciones</h1>

<p>Creimos que arrancar un relevamiento de aplicaciones por seguridad y criticidad
de los datos, podr&#xED;a ayudarnos a armar ambientes disjuntos.</p>

<p>Esta idea deriv&#xF3; en analizar herramientas para deployar aplicaciones web de
forma aislada.</p>

<ul>
<li><p>Algunas ideas:</p>

<ul>
<li>Apache modulo itk</li>
<li><a href="http://php-fpm.org/">PHP fpm</a></li>
<li>No todo es xAMP</li>
<li>Contenedores: <a href="http://openvz.org/">OpenVZ</a>, <a href="http://lxc.sourceforge.net/">Linux
Containers</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/03_soluciones/5">
<h1>Configuraciones de Apache con VHosts por usuario</h1>

<ul>
<li>Trabajamos en conjunto entre CeRT, Guarani, Desarrollo y Soporte analizando
alternativas</li>
<li>Los ambientes no eran los mismos pero todos usabamos Apache, PHP y alguna base
de datos: Mysql, Postgres o Informix</li>
<li>Se encontr&#xF3; el modulo <a href="http://mpm-itk.sesse.net/">Apache ITK</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/03_soluciones/6">
<h1>Configuraciones de Apache con VHosts por usuario</h1>

<ul>
<li>Se definieron procedimientos para configurar un Apache seguro y
estandar:

<ul>
<li>Errores en castellano, con un estilo similar para todas nuestra aplicaciones</li>
<li>No revelar la identidad del servidor</li>
<li>No permitir ejecuciones de scripts en algunos directorios</li>
<li>Evitar que interfieran entre aplicaciones</li>
</ul></li>
<li>Problemas?

<ul>
<li>Gestionar usuarios para cada aplicacion</li>
<li>Distintos ambientes: testing, producci&#xF3;n</li>
<li>Aplicaciones Ruby y Java</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="00-intro/03_soluciones/7">
<h1>Reglas de iptables por usuario de aplicacion</h1>

<p>Ejemplo de la regla por defecto de una aplicaci&#xF3;n WEB que no use una API o
servicio:</p>

<pre class="sh_sh"><code>iptables -P OUTPUT DROP
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -I INPUT -m state --ESTABLISHED,RELATED \
    -j ACCEPT
iptables -I INPUT -p tcp --dport 80 -j ACCEPT
iptables -I OUTPUT -m state --STATE ESTABLISHED,RELATED \
    -j ACCEPT
iptables -I OUTPUT -m owner --gid-owner webservers \
    -m state --state ESTABLISHED,RELATED -j ACCEPT</code></pre>

<ul>
<li>Problemas

<ul>
<li>Manejar qu&#xE9; aplicaci&#xF3;n se conecta con qu&#xE9; otra</li>
<li>Y al migrar una dependencia?</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="00-intro/03_soluciones/8">
<h1>Encontramos nuevos productos</h1>

<ul>
<li><a href="http://php-fpm.org/">PHP fpm</a></li>
<li><a href="http://nginx.org/">Nginx</a></li>
<li><a href="https://www.varnish-cache.org/">Varnish</a></li>
<li>Ruby:

<ul>
<li><a href="https://www.phusionpassenger.com">Apache Passenger</a></li>
<li><a href="http://unicorn.bogomips.org/">Unicorn</a></li>
<li><a href="http://puma.io/">Puma</a></li>
</ul></li>
</ul>

<p>Necesitamos expertice de nuestros equipos de trabajo en estos productos</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center subsection" ref="00-intro/04_devops/1">
<h1>Devops</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/04_devops/2">
<h1>Devops</h1>

<p><em>DevOps</em> es una nueva tendencia orientada a obtener una relaci&#xF3;n colaborativa de
trabajo entre las &#xE1;reas de desarrollo  y TI</p>

<ul>
<li><p>Objetivos</p>

<ul>
<li>Mejorar el tiempo de respuesta</li>
<li>Cumplir con las fases del proyecto seg&#xFA;n lo planeado</li>
<li>Exigir confiabilidad, estabilidad, resiliencia  y seguridad en el ambiente de operaciones</li>
</ul></li>
<li><p>Uno de los lemas de DevOps es</p>

<ul>
<li><em>Desarrolladores que piensen como operadores y
operadores que piensen como desarrolladores</em></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/04_devops/3">
<h1>Devops</h1>

<p>DevOps puede verse como un m&#xE9;todo de desarrollo de software que promueve la
comunicaci&#xF3;n, colaboraci&#xF3;n e integraci&#xF3;n entre desarrolladores y
administradores de TI. </p>

<p>Su objetivo es liberar r&#xE1;pidamente productos y servicios de
software.</p>

<ul>
<li>Sus origenes:

<ul>
<li>Velocity Conference</li>
<li>Infrastructure as a code</li>
<li>Agile Infrastructure</li>
<li>Agile system administration</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/04_devops/4">
<h1>Ciclo de vida</h1>

<h2>Ciclo de vida</h2>

<p>Se define Ciclo de vida el tiempo promedio que toma desde que un nuevo
requerimiento es aprobado, se hace un requerimiento de cambio, o un error es
identificado, hasta su pase a producci&#xF3;n.</p>

<p>Organizaciones que utilizan m&#xE9;todos &#xE1;giles necesitan minimizar este ciclo de
vida y reducirlo a minutos, en algunos casos.</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="00-intro/04_devops/5">
<h1>Versionado de contextos/ambientes</h1>

<h2>Versionado de contextos/ambientes</h2>

<p>El personal de  Operaciones debe lidiar con m&#xFA;ltiples configuraciones e
instalaci&#xF3;n de actualizaciones. Estos cambios implican una nueva <em>versi&#xF3;n</em> de
ese ambiente. La &#xFA;nica manera de realizarlo a tiempo, en forma documentada y
minimizando la posibilidad de error es a trav&#xE9;s de scripts.</p>

<p>Ante estas exigencias, surge la tendencia llamada <em>Infrastructure as a code</em>.</p>

<p>Los scripts generan nuevos entornos virtuales que deben ser versionados como el
c&#xF3;digo tradicional, administrando la configuraci&#xF3;n de acuerdo a las buenas
pr&#xE1;cticas.</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="00-intro/05_prods/1">
<h1>Productos que simplifican las tareas</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets incremental smaller" ref="00-intro/05_prods/2">
<h1>Productos que simplifican las tareas</h1>

<ul>
<li>Virtualizaci&#xF3;n

<ul>
<li>VMWare</li>
<li>Proxmox</li>
<li>Otros que tengo ganas de analizar: <em>Openstack, Xen</em></li>
</ul></li>
<li>Infarestructure as Code 

<ul>
<li><strong>Chef</strong></li>
<li>Puppet</li>
</ul></li>
<li>Versionado de c&#xF3;digo

<ul>
<li>Subversion</li>
<li><strong>Git</strong></li>
</ul></li>
<li>Conducta

<ul>
<li>Este es el punto m&#xE1;s dificil de alcanzar</li>
<li>Nuestra sociedad <strong>no sabe</strong> respetar convenciones</li>
<li>El aporte diario e individual se vuelve fruct&#xED;fero al tiempo de aplicar
convenciones</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/01_intro/1">
<h1>Chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets incremental small" ref="01-chef-dev/01_intro/2">
<h1>Introducci&#xF3;n</h1>

<ul>
<li>Conceptos sobre Chef</li>
<li>Fundamentos de ruby

<ul>
<li>El ambiente</li>
<li>Probando ruby</li>
<li>Breve introducci&#xF3;n al lenguaje</li>
<li>Qu&#xE9; son las gemas</li>
<li>Material de Ruby</li>
</ul></li>
<li>GIT</li>
<li>Desarrollando con chef

<ul>
<li>Vagrant</li>
<li>Estructura de directorios</li>
<li>Cookbooks y recipes</li>
<li>Resources y Providers</li>
<li>Atributos</li>
<li>Un recipe para ntp</li>
<li>Berkshelf</li>
<li>Roles</li>
<li>Environments</li>
<li>Databags</li>
<li>Ciclo de desarrollo en Chef</li>
<li>Amazon EC2</li>
<li>Material de chef</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/02_chef_intro/1">
<h1>Conceptos sobre Chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/02_chef_intro/2">
<h1>Conceptos sobre Chef</h1>

<ul>
<li>Chef permite modelar la evoluci&#xF3;n de nuestra infraestructura y aplicaciones como si fueran c&#xF3;digo</li>
<li>No impone restricciones</li>
<li>Permite describir y automatizar los procesos e infraestructura</li>
<li>La consecuencia es que la infraestructura se vuelve:

<ul>
<li>Versionable</li>
<li>Testeable</li>
<li>Replicable</li>
</ul></li>
<li><a href="http://www.opscode.com/customers/">&#xBF;Quienes lo usan?</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/02_chef_intro/3">
<h1>Conceptos sobre Chef</h1>

<ul>
<li>Para lograr su objetivo se utilizan definiciones reutilizables llamadas
<strong>cookbooks</strong> y <strong>recipes</strong></li>
<li>Los recipes se programan en Ruby</li>
<li>Permiten automatizar tareas repetitivas</li>
<li>Chef aplica estas definiciones en servidores produciendo as&#xED; una
infraestructura automatizada</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/02_chef_intro/4">
<h1>Cookbooks y recipes</h1>

<ul>
<li>Los cookbooks y recipes se construyen a partir de <strong>resources</strong></li>
<li>Chef provee una gran cantidad de resources</li>
<li>Adem&#xE1;s pueden escribirse los propios</li>
<li>Muchos son contribuciones de la comunidad que utiliza Chef a partir de
cookbooks p&#xFA;blicos</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center" ref="01-chef-dev/02_chef_intro/5">
<h1>Code CAN</h1>

<p><a href="http://www.youtube.com/embed/T8ijdOQj4ZA">Ver video</a></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center" ref="01-chef-dev/02_chef_intro/6">
<h1>Topolog&#xED;a de Chef</h1>

<p><img src="./file/01-chef-dev/topologia-chef.png" alt="topologia"/>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/03_ruby/1">
<p><a href="http://www.ruby-lang.org/es/"><img src="./file/01-chef-dev/ruby.png" alt="Ruby"/></a>

<h1>Fundamentos de ruby</h1>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/03_ruby/2">
<h1>Fundamentos de ruby</h1>

<ul>
<li>De origen Japon&#xE9;s</li>
<li>Lenguaje simple de leer

<ul>
<li>Simple pero potente</li>
</ul></li>
<li>Permite la definici&#xF3;n de DSL

<ul>
<li>DSL: Domain Specific Language</li>
</ul></li>
<li>Interpretado, reflexivo, orientado a objetos</li>
<li>Inspirado en:

<ul>
<li>Sintaxis: Python y Perl</li>
<li>Caracter&#xED;sticas de programaci&#xF3;n similares a Smalltalk, y en algunos aspectos a
LISP, LUA</li>
</ul></li>
<li>Hay muchas implementaciones de m&#xE1;quinas virtuales, las m&#xE1;s usadas son:

<ul>
<li><a href="http://www.ruby-lang.org/es/">MRI</a></li>
<li><a href="http://jruby.org/">jRuby</a></li>
<li><a href="http://rubini.us/">Rubinius</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute" ref="01-chef-dev/03_ruby/3">
<h1>Ejemplo de codigo ruby</h1>

<pre class="sh_ruby"><code>1 + 2           # =&gt; 3
2 * 7           # =&gt; 14
5 / 2           # =&gt; 2
5 / 2.0         # =&gt; 2.5
1 + (2 * 3)     # =&gt; 7 </code></pre>

<p><em>Ruby siempre retorna un valor. En el caso anterior la ejecuci&#xF3;n del c&#xF3;digo
retorna 7 que es la &#xFA;ltima instrucci&#xF3;n</em></p>

<pre class="sh_ruby"><code>result = [1, 2, 3].map { |n| n*7 }</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/03_ruby/4">
<h1>El ambiente</h1>

<p><img src="./file/01-chef-dev/ambiente.png" alt="ambiente"/>

<ul>
<li><strong>No conviene instalarlo directamente con apt-get</strong></li>
<li>Se utilizan manejadores de m&#xE1;quinas virtuales de Ruby

<ul>
<li><a href="https://rvm.io/">rvm</a></li>
<li><a href="http://rbenv.org/">rbenv</a></li>
</ul></li>
</ul>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/03_ruby/5">
<h1>Instalando rvm</h1>

<pre><code><code class="command">$ \curl -L https://get.rvm.io | bash -s stable</code>
<code class="result">    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                                                 Dload  Upload   Total   Spent    Left  Speed
100   184  100   184    0     0    168      0  0:00:01  0:00:01 --:--:--   216
100 13466  100 13466    0     0   6708      0  0:00:02  0:00:02 --:--:-- 54518
Downloading RVM from wayneeseguin branch stable
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                                                 Dload  Upload   Total   Spent    Left  Speed
100   124  100   124    0     0    132      0 --:--:-- --:--:-- --:--:--   222
100 1067k  100 1067k    0     0   171k      0  0:00:06  0:00:06 --:--:--  222k

Installing RVM to ...
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/6">
<h1>Verificamos la instalaci&#xF3;n de rvm</h1>

<h2>Primero debemos reiniciar sesi&#xF3;n o</h2>

<pre><code><code class="command">$ source .bash_profile</code>
</code></pre>

<h2>Verificamos que rvm est&#xE1; instalado:</h2>

<pre><code><code class="command">$ type cd</code>
<code class="result">cd: es una funci&#xF3;n
cd () 
{ 
        if builtin cd "$@"; then
                [[ -n "${rvm_current_rvmrc:-}" &amp;&amp; "$*" == "." ]] &amp;&amp; rvm_current_rvmrc=""
|| true;
                __rvm_cd_functions_set;
                return 0;
        else
                return $?;
        fi
}
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/7">
<h1>Instalamos ruby 1.9.3 con rvm</h1>

<h2>Requiere que el usuario sea sudoer</h2>

<pre><code><code class="command">$ rvm install 1.9.3</code>
<code class="result">Searching for binary rubies, this might take some time.
ruby-1.9.3-p429 - #configure
ruby-1.9.3-p429 - #download
ruby-1.9.3-p429 - #validate archive
ruby-1.9.3-p429 - #extract
ruby-1.9.3-p429 - #validate binary
ruby-1.9.3-p429 - #setup
Saving wrappers to '/home/.../.rvm/wrappers/ruby-1.9.3-p429'........
ruby-1.9.3-p429 - #importing default gemsets, this may take
time.......................

</code><code class="command">$ rvm list</code>
<code class="result">rvm rubies

=* ruby-1.9.3-p429 [ x86_64 ]

</code><code class="command"># =&gt; - current</code>
<code class="command"># =* - current &amp;&amp; default</code>
<code class="command"># * - default</code>
</code></pre>

<p class="notes">Si no queremos que rvm maneje el manejador de paquetes, podemos deshabilitarlo con: <code>$ rvm autolibs disable</code></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/8">
<h1>Rubies disponibles</h1>

<pre><code><code class="command">$ rvm list known</code>
<code class="command"># MRI Rubies</code>
<code class="result">[ruby-]1.8.6[-p420]
[ruby-]1.8.7[-p371]
[ruby-]1.9.1[-p431]
[ruby-]1.9.2[-p320]
[ruby-]1.9.3-p125
[ruby-]1.9.3-p194
[ruby-]1.9.3-p286
[ruby-]1.9.3-p327
[ruby-]1.9.3-p362
[ruby-]1.9.3-p374
[ruby-]1.9.3-p385
[ruby-]1.9.3-p392
[ruby-]1.9.3[-p429]
[ruby-]1.9.3-head
[ruby-]2.0.0-rc1
[ruby-]2.0.0-rc2
[ruby-]2.0.0-p0
[ruby-]2.0.0[-p195]
ruby-head
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/9">
<h1>Probando Ruby</h1>

<h2>Desde la consola</h2>

<pre><code><code class="command">$ ruby -e 'user=ENV["USER"]; print "Hola #{user}!!\n"'</code>
</code></pre>

<h2>En forma interactiva</h2>

<pre><code><code class="command">$ irb</code>
<code class="result">1.9.3-p429 :001 &gt; 2+2
 =&gt; 4 
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute" ref="01-chef-dev/03_ruby/10">
<h1>Un poco de Ruby</h1>

<h2>Comentarios</h2>

<pre class="sh_ruby"><code>#Este es un comentario</code></pre>

<h2>Asignaci&#xF3;n</h2>

<pre class="sh_ruby"><code>x = 1</code></pre>

<h2>Strings</h2>

<pre class="sh_ruby"><code>"con comillas dobles"
'con comillas simples'
"El resultado de 2+2 = #{2+2}"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute small" ref="01-chef-dev/03_ruby/11">
<h1>Un poco de Ruby</h1>

<h2>Booleans</h2>

<p>Ruby tiene una visi&#xF3;n simplista de la verdad: <em>todo lo que no sea <code>nil</code> o la constante <code>false</code> es <code>verdadero</code></em> </p>

<pre class="sh_ruby"><code>true            # =&gt; true
false           # =&gt; false
nil             # =&gt; nil
1 == 1          # =&gt; true 
1 == true       # =&gt; false 
nil == false    # =&gt; false </code></pre>

<h2>Negacion</h2>

<pre class="sh_ruby"><code>!true           # =&gt; false
!false          # =&gt; true
!nil            # =&gt; true
1 != 2          # =&gt; true 
1 != 1          # =&gt; false</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute" ref="01-chef-dev/03_ruby/12">
<h1>Un poco de Ruby</h1>

<h2>S&#xED;mbolos</h2>

<p>Son constantes, que se precedent con el s&#xED;mbolo <code>:</code> que ocupan un &#xFA;nico espacio de memoria:</p>

<pre class="sh_ruby"><code>:mi_simbolo.object_id  # =&gt; 461608
"mi_string".object_id  # =&gt; 9986260
"mi_string".object_id  # =&gt; 9996160
:mi_simbolo.object_id  # =&gt; 461608</code></pre>

<p>Los s&#xED;mbolos son usados generalmente para acceder a arreglos asociativos, por
ejemplo:</p>

<pre class="sh_ruby"><code>default[:apache][:ports]</code></pre>

<p class="notes">Usar simbolos para mejorar el uso de memoria puede ser un memory leak en algunos casos</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute small" ref="01-chef-dev/03_ruby/13">
<h1>Un poco de Ruby</h1>

<h2>Listas con arreglos</h2>

<pre class="sh_ruby"><code>x = ["a", "b", "c"] # =&gt; ["a", "b", "c"]
x[0]                # =&gt; "a" 
x.first             # =&gt; "a" 
x.last              # =&gt; "c"
x + ["d"]           # =&gt; ["a", "b", "c", "d"]
x                   # =&gt; ["a", "b", "c"] 
x = x + ["d"]       # =&gt; ["a", "b", "c", "d"]
x                   # =&gt; ["a", "b", "c", "d"]
x += ["e"]          # =&gt; ["a", "b", "c", "d","e"]
x                   # =&gt; ["a", "b", "c", "d","e"]</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute small" ref="01-chef-dev/03_ruby/14">
<h1>Un poco de Ruby</h1>

<h2>Operando con las listas</h2>

<pre class="sh_ruby"><code>x = [1, 2, 3, 4]
x.all?                     # =&gt; true
x.all? {|x| x % 2 == 0 }   # =&gt; false
x.any? {|x| x % 2 == 0 }   # =&gt; true
x.detect {|x| x % 2 == 0 } # =&gt; 2
x.each {|x| p x }          # =&gt; Imprime cada elem
x.select {|x| x % 2 }      # =&gt; [2, 4]
x.collect {|x| x*2 }       # =&gt; [2, 4, 6, 8]
x.map                      # Idem collect 
x.first                    # =&gt; 1
x.last                     # =&gt; 4
x[0]                       # =&gt; 1</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/03_ruby/15">
<h1>Un poco de Ruby</h1>

<h2>Bloques</h2>

<ul>
<li>En el ejemplo anterior usabamos bloques con <code>{...}</code></li>
<li>Un bloque puede tener par&#xE1;metros <code>{ |x| ...}</code></li>
<li>Los bloques pueden escribirse en m&#xE1;s de una l&#xED;nea usando <code>do... end</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute" ref="01-chef-dev/03_ruby/16">
<h1>Un poco de Ruby</h1>

<h2>Bloques en m&#xE1;s de una l&#xED;nea</h2>

<pre class="sh_ruby"><code>array = [1, 2, 3, 4]

array.collect! do |n|
    n ** 2
end

array</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute smaller" ref="01-chef-dev/03_ruby/17">
<h1>Un poco de Ruby</h1>

<h2>Hashes</h2>

<p>Los Hashes son arreglos asociativos y por su estructura semejante a un registro,
son muy utilizados</p>

<pre class="sh_ruby"><code>grades = { 
  "Jane Doe" =&gt; 10, 
  "Jim Doe" =&gt; 6 
}
grades["Jane Doe"]                # =&gt; 10</code></pre>

<h3>La sintaxis cambi&#xF3; a partir de la versi&#xF3;n 1.9</h3>

<pre class="sh_ruby"><code>options = {                       # =&gt; Sintaxis &lt;= 1.8
  :opt_1 =&gt; 1, 
  :opt_2 =&gt; 2
}
options = { opt_1: 1, opt_2: 2}   # =&gt; Sintaxis &gt; 1.8</code></pre>

<blockquote>
<p>Si un Hash utiliza strings para sus claves, los s&#xED;mbolos no podr&#xE1;n ser utilizados de forma indistinta. Para este tipo de situaciones se utilizan <a href="https://github.com/mbleigh/mash">Mash</a></p>
</blockquote>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute smaller" ref="01-chef-dev/03_ruby/18">
<h1>Un poco de Ruby</h1>

<h2>El <code>if</code></h2>

<p>En ruby, toda expresi&#xF3;n retorna algo. Por tanto:</p>

<pre class="sh_ruby"><code>a = if true
    3
end</code></pre>

<p>Se puede escribir en una &#xFA;nica l&#xED;nea:</p>

<pre class="sh_ruby"><code>a = 1
a = 7 if a &lt; 2</code></pre>

<p>Existen <code>else</code> y <code>elsif</code>:</p>

<pre class="sh_ruby"><code>a = 10
if a &lt; 2
    a = 3
elsif a == 2
    a = 4
else
    a = 5
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute" ref="01-chef-dev/03_ruby/19">
<h1>Un poco de Ruby</h1>

<h2>El <code>unless</code></h2>

<p>Se utiliza para evitar <code>if ! &lt;expresion&gt;</code></p>

<pre class="sh_ruby"><code>a = 5
unless a == 4
    a = 7
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content execute smaller" ref="01-chef-dev/03_ruby/20">
<h1>Un poco de Ruby</h1>

<h2>M&#xE9;todos</h2>

<p>Los m&#xE9;todos se crean con la palabra <code>def</code></p>

<pre class="sh_ruby"><code>def do_something_useless( first_argument, second_argument)
    "You gave me #{first_argument} and #{second_argument}"
end
do_something_useless( "apple", "banana")</code></pre>

<p>Y se invoca con o sin par&#xE9;ntesis</p>

<pre class="sh_ruby"><code>do_something_useless( "apple", "banana")
# =&gt; "You gave me apple and banana"
do_something_useless 1, 2
# =&gt; "You gave me 1 and 2"</code></pre>

<blockquote>
<p>No usar par&#xE9;ntesis puede traer problemas por las reglas de precedencia</p>
</blockquote>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/03_ruby/21">
<h1>Un poco de Ruby</h1>

<h2>Clases y Modulos</h2>

<ul>
<li><p>No son necesarios en chef porque provee un DSL. Podr&#xED;amos usar clases si
deseamos, pero el modelo de objetos necesario para Chef no amerita
complicaciones</p></li>
<li><p>Las clases son el concepto conocido</p></li>
<li><p>Los m&#xF3;dulos permiten:</p>

<ul>
<li>Definir <code>namespaces</code> y sobrecargar clases</li>
<li>Permiten implementar <code>mixins</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/03_ruby/22">
<h1>Qu&#xE9; son las gemas</h1>

<ul>
<li>Las gemas son librer&#xED;as empaquetadas que se instalan desde la red e instalan
en mi ambiente</li>
<li>Hist&#xF3;ricamente se manejaban con el comando <code>gem</code></li>
<li>Luego <code>rvm</code> introdujo el concepto de <code>gemsets</code></li>
<li>Actualmente las gemas se manejan con <a href="http://gembundler.com/">bundler</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/23">
<h1>Uso de bundler</h1>

<h2>Instalando bundler</h2>

<pre><code><code class="command">$ gem install bundler</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/24">
<h1>Uso de bundler</h1>

<h2>Usando bundler</h2>

<p>Crear un nuevo directorio:</p>

<pre><code><code class="command">$ mkdir mi_proyecto</code>
</code></pre>

<p>Inicializamos el nuevo directorio</p>

<pre><code><code class="command">$ bundle init</code>
<code class="result">Writing new Gemfile to /xxx/Gemfile
</code></code></pre>

<p>Esto crear&#xE1; un archivo llamado Gemfile, donde podemos agregar dependencias que
utilizaremos en este proyecto, considerando incluso ambientes: <em>desarrollo</em>,
<em>producci&#xF3;n</em></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/03_ruby/25">
<h1>Uso de bundler</h1>

<p>Editamos el archivo <code>Gemfile</code> y agregamos las gemas necesarios, en este ejemplo
<strong>rainbow</strong></p>

<pre class="sh_ruby"><code><code class="command"># A sample Gemfile</code>
<code class="result">source "https://rubygems.org"

</code><code class="command"># gem "rails"</code>
<code class="result">gem "rainbow"</code></code></pre>

<p>Actualizamos el proyecto:</p>

<pre><code><code class="command">$ bundle  # o bundle install o bundle update</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline small" ref="01-chef-dev/03_ruby/26">
<h1>Uso de bundler</h1>

<h2>Usando la Gema</h2>

<p>Y ahora podemos crear un script ruby <code>test.rb</code>:</p>

<pre class="sh_ruby"><code><code class="command"># require 'rainbow'</code>
<code class="result">
puts "this is red".foreground(:red) 
puts "this on yellow bg".background(:yellow)
puts "even bright underlined!".underline.bright</code></code></pre>

<p><em>En el ejemplo hay que eliminar el comentario <code>#</code> dejando s&#xF3;lo <code>require 'rainbow'</code></em></p>

<p>Para correrlo es <em>IMPORTANTE</em>:</p>

<pre><code><code class="command">$ bundle exec &lt;comando&gt;</code>
</code></pre>

<p>En este caso ser&#xED;a:</p>

<pre><code><code class="command">$ bundle exec ruby test.rb</code>
</code></pre>

<p><code>bundle exec</code> ejecuta el comando usando el ambiente con las gemas mencionadas en el Gemfile</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/03_ruby/27">
<h1>Material de Ruby</h1>

<ul>
<li><a href="http://tryruby.org/">Try Ruby</a></li>
<li><a href="http://pragprog.com/book/ruby/programming-ruby">Programming Ruby (2nd
edition)</a></li>
<li><a href="http://www.ruby-doc.org/core-2.0/">API Ruby</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/04_git/1">
<p><a href="http://git-scm.com/"><img src="./file/01-chef-dev/git.png" alt="GIT"/></a>

<h1>Un poco de GIT</h1>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small incremental" ref="01-chef-dev/04_git/2">
<h1>Introducci&#xF3;n</h1>

<ul>
<li>Es un <strong>SCM</strong> <em>(Source Code Management)</em></li>
<li>Si usabas SVN, hay que comprarse:
<img src="./file/01-chef-dev/MIB.png" alt="MIB Memory eraser"/>
</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content fullpage" ref="01-chef-dev/04_git/3">
<p><img src="./file/01-chef-dev/git-workflow.png" alt="Git workflow"/>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/04_git/4">
<h1>Comandos b&#xE1;sicos</h1>

<pre><code><code class="command">$ mkdir mi_proyecto</code>
<code class="command">$ cd mi_proyecto</code>
<code class="command">$ git init </code>
<code class="result">Initialized empty Git repository in /xxx/mi_proyecto/.git/
</code><code class="command">$ ls -a</code>
<code class="result">.  ..  .git
</code><code class="command">$ echo Hola &gt; README.md</code>
<code class="command">$ git status</code>
<code class="result"> # On branch master
 #
 # Initial commit
 #
 # Untracked files:
 #   (use "git add &lt;file&gt;..." to include in what will be committed)
 #
 #  README.md
 nothing added to commit but untracked files present (use "git add" to track)
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/04_git/5">
<h1>Comandos b&#xE1;sicos</h1>

<h3>Agregando al Staging Area y luego al repo local</h3>

<pre><code><code class="command">$ git add README.md</code>
<code class="command">$ git status</code>
<code class="result"> # On branch master
 #
 # Initial commit
 #
 # Changes to be committed:
 #   (use "git rm --cached &lt;file&gt;..." to unstage)
 #
 #  new file:   README.md
 #
</code><code class="command">$ git commit -m "Importacion inicial"</code>
<code class="result">[master (root-commit) 3667c85] Importacion inicial
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/04_git/6">
<h1>Comandos b&#xE1;sicos</h1>

<h3>Agregando repos remotos</h3>

<pre><code><code class="command">$ git remote -v</code>
<code class="command">$ git remote add origin URL</code>
<code class="command">$ git remote -v</code>
<code class="result">origin URL (fetch)
origin URL (push)
</code><code class="command">$ git push -u &lt;URL de remoto&gt; &lt;branch&gt;</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/04_git/7">
<h1>Algunos conceptos</h1>

<ul>
<li>El <strong>branch</strong> por defecto es <strong>master</strong></li>
<li>A la URL remota donde hacemos push se lo denomina <strong>upstream</strong> </li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/04_git/8">
<h1>Github</h1>

<p><a href="https://github.com"><img src="./file/01-chef-dev/github.png" alt="Github"/></a>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/04_git/9">
<h1>Github</h1>

<ul>
<li>Es una red social de c&#xF3;digo</li>
<li>Utiliza GIT</li>
<li>Cada usuario es due&#xF1;o de sus repositorios</li>
<li>No es posible hacer push en repositorio de otros usuarios

<ul>
<li>Intorduce el concepto de <strong>fork</strong></li>
<li>Y el de <strong>pull requests</strong></li>
</ul></li>
<li>Permite la colaboraci&#xF3;n mucho m&#xE1;s &#xE1;gil:

<ul>
<li>Se comentan los patch a proyectos</li>
<li>Se aceptan o no por el due&#xF1;o</li>
<li>Si no lo aceptan, uso mi fork</li>
</ul></li>
<li>Pueden definirse organizaciones que agrupan usuarios y en este caso es posible
compartir repositorios

<ul>
<li><a href="https://github.com/chrodriguez">Mi espacio en Github</a></li>
<li><a href="https://github.com/Desarrollo-CeSPI">El espacio de CeSPI en Github</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/04_git/10">
<h1>Material de GIT</h1>

<ul>
<li><a href="http://try.github.io/">Try GIT</a></li>
<li><a href="http://git-scm.com/">Libro de GIT</a></li>
<li><a href="http://pcottle.github.io/learnGitBranching/">Git branching</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/05_desarrollando_con_chef/1">
<h1>Desarrollando con Chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/05_desarrollando_con_chef/2">
<p><img src="./file/01-chef-dev/vagrant.png" alt="Vagrant"/>

<h1>Vagrant</h1>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/3">
<h1>Por qu&#xE9; Vagrant</h1>

<ul>
<li>Simplifica el manejo de ambientes de trabajo en cuanto a:

<ul>
<li>Configuraci&#xF3;n</li>
<li>F&#xE1;cil replicaci&#xF3;n</li>
</ul></li>
<li>Para ello Vagrant se sube al hombro de gigantes como:

<ul>
<li><a href="https://www.virtualbox.org/">VirtualBox</a></li>
<li><a href="http://www.vmware.com/">VMWare</a></li>
<li><a href="http://aws.amazon.com/es/ec2/">AWS</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/05_desarrollando_con_chef/4">
<h1>Como podr&#xED;a ayudarnos</h1>

<ul>
<li>Para desarrollo

<ul>
<li>Aislar&#xE1; dependencias de los ambientes</li>
<li>Replicable y reproducible en instantes</li>
<li>Una vez que alguien comparte un <code>Vagrantfile</code>, corriendo <code>vagrant up</code>
tenemos el ambiente listo </li>
<li>Si el ambiente del desarrollador es Windows, Linux o Mac, ahora es posible
replicar de la misma forma el ambiente tal cuel fue creado,
independientemente de la plataforma del desarrollador</li>
</ul></li>
<li>Para administradores

<ul>
<li>Ambientes descartables</li>
<li>Workflow consistente para el desarrollo y testeo de scripts de manejo de
infraestructura. </li>
<li>Pueden testearse <em>shell scripts</em>, <em>Chef Cookbooks</em>, <em>m&#xF3;dulos de Puppet</em>,
utilizando virtualizaci&#xF3;n local como VirtualBox o VMWare.</li>
<li>Luego con la misma configuraci&#xF3;n puede testearse el ambiente en la cloud
como AWS o Rackspace</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/5">
<h1>Qu&#xE9; es en criollo</h1>

<ul>
<li>Si usamos VirtualBox, <code>Vagrant</code> maneja las VMs como templates</li>
<li>Simplifica la gesti&#xF3;n de VMs sin usar una GUI para su configuraci&#xF3;n</li>
<li>La conexi&#xF3;n con la VM se hace a trav&#xE9;s de ssh, pero sin utilizar una IP:
<code>vagrant ssh</code></li>
<li>Ante la duda del estado de la VM, con un simple <code>vagrant destroy</code> seguido de
un <code>vagrant up</code> volvemos al punto de partida</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/6">
<h1>C&#xF3;mo se instala</h1>

<ul>
<li>Hay dos variantes debido a que la &#xFA;ltima versi&#xF3;n cambi&#xF3; la forma de
instalarlo:

<ul>
<li>En la versi&#xF3;n 1.0.X se instalaba como una <em>gema de ruby</em></li>
<li>En las &#xFA;ltimas versiones se provee de un instalador</li>
</ul></li>
<li>Usaremos la &#xFA;ltima versi&#xF3;n: 1.2.X

<ul>
<li>Descargamos la versi&#xF3;n para nuestro Sistema desde
<a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental smaller" ref="01-chef-dev/05_desarrollando_con_chef/7">
<h1>C&#xF3;mo se usa</h1>

<h2>Up and running</h2>

<pre><code><code class="command">$ vagrant init ubuntu-1204 \
    http://vagrantbox.desarrollo.cespi.unlp.edu.ar/pub/ubuntu-12.04.2-cespi-amd64.box</code>
<code class="command">$ vagrant up</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/05_desarrollando_con_chef/8">
<h1>C&#xF3;mo se usa</h1>

<p>Luego de correr los comandos anteriores, dispondremos de una m&#xE1;quina virtual en
VirtualBox con Ubuntu 12.04 LTS de 32 bits. </p>

<p>Ser&#xE1; posible hacer un ssh a esta m&#xE1;quina haciendo <code>vagrant ssh</code></p>

<p>Una vez que no se utilice m&#xE1;s la VM, ser&#xE1; posible eliminar cualquier rastro de
la misma, utilizando <code>vagrant destroy</code></p>

<p><strong>Es probable que los comandos <code>vagrant up</code> y <code>vagrant ssh</code> no funcionen porque no se especific&#xF3; la
IP que daremos al equipo en <code>Vagrantfile</code>. Lo veremos m&#xE1;s adelante</strong></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/05_desarrollando_con_chef/9">
<h1>C&#xF3;mo se usa</h1>

<h2><code>vagrant init [&lt;box-name&gt; &lt;URL&gt;]</code></h2>

<p>Este comando corrido en un directorio, crea &#xFA;nicamente un archivo llamado
<code>Vagrantfile</code></p>

<p>El arcihvo es c&#xF3;digo <strong>ruby</strong>, y es bastante claro dado que se encuentra muy
documentado</p>

<p>La documentaci&#xF3;n de las opciones de <code>Vagrantfile</code> puede verse <a href="http://docs.vagrantup.com/v2/vagrantfile/machine_settings.html">aqu&#xED;</a></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/05_desarrollando_con_chef/10">
<h1>C&#xF3;mo se usa</h1>

<h2>B&#xFA;squeda del <code>Vagrantfile</code></h2>

<p>Cuando queremos iniciar vagrant con <code>vagrant up</code>, si estamos en el directorio
<code>/home/car/Trabajo/cespi/mis_vms/un_proyecto</code> entonces buscar&#xE1; en los siguientes
directorios:</p>

<pre class="sh_sh"><code>/home/car/Trabajo/cespi/mis_vms/un_proyecto/Vagrantfile
/home/car/Trabajo/cespi/mis_vms/Vagrantfile
/home/car/Trabajo/cespi/Vagrantfile
/home/car/Trabajo/Vagrantfile
/home/car/Vagrantfile
/home/Vagrantfile
/Vagrantfile</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline smaller" ref="01-chef-dev/05_desarrollando_con_chef/11">
<h1>C&#xF3;mo se usa</h1>

<h2>Como se manejan los boxes</h2>

<pre><code><code class="command">$ vagrant box list</code>
<code class="command">$ vagrant box add name &lt;URL&gt;</code>
<code class="command">$ vagrant box remove &lt;name&gt; provider</code>
</code></pre>

<p>En el ejemplo inicial:</p>

<pre><code><code class="command">$ vagrant init ubuntu-1204 \
    http://vagrantbox.desarrollo.cespi.unlp.edu.ar/pub/ubuntu-12.04.2-cespi-amd64.box</code>
</code></pre>

<p>Se cre&#xF3; autom&#xE1;ticamente el box <code>ubuntu-1204</code> luego de hacer <code>vagrant up</code></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/12">
<h1>C&#xF3;mo se usa</h1>

<h2>Como encuentro boxes</h2>

<ul>
<li><a href="http://www.vagrantbox.es/">http://www.vagrantbox.es/</a></li>
<li>Una creada por nosotros: 

<ul>
<li><a href="vagrantbox.desarrollo.cespi.unlp.edu.ar/pub/ubuntu-12.04.2-cespi-amd64.box">Ubuntu 12.04 64 bits con Chef
11.4</a></li>
</ul></li>
<li>Creandolas a gusto con <a href="https://github.com/jedi4ever/veewee">Veewee</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/13">
<h1>C&#xF3;mo se usa</h1>

<h2>Aprovisionando las VMS</h2>

<ul>
<li>Con <code>vagrant</code> iniciamos una VM inmaculada tal cu&#xE1;l nos provee el template de
un <code>box</code> espec&#xED;fico</li>
<li>Podemos aprovisionar estas m&#xE1;quinas instalando ambientes usando:

<ul>
<li><strong>Chef solo</strong> &lt;= Es el que vamos a usar</li>
<li>Chef client</li>
<li>Puppet</li>
<li>Shell scripting</li>
<li><a href="http://ansible.cc/">Ansible</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center subsection" ref="01-chef-dev/05_desarrollando_con_chef/14">
<h1>Desarrollando con Chef</h1>

<p><em>y Vagrant</em></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/05_desarrollando_con_chef/15">
<h1>Desarrollando con Chef</h1>

<ul>
<li>Se respeta una filosof&#xED;a muy instaurada en la comunidad Ruby

<ul>
<li><strong>Convention over configuration</strong></li>
</ul></li>
<li>Todos los cookbooks tienen la misma estructura</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/05_desarrollando_con_chef/16">
<h1>Estructura de un cookbook</h1>

<pre><code><code class="command">$ tree -d mis_cookbooks/mi_cookbook</code>
<code class="result"> &#x251C;&#x2500;&#x2500; attributes
 &#x251C;&#x2500;&#x2500; definitions
 &#x251C;&#x2500;&#x2500; files
 &#x251C;&#x2500;&#x2500; libraries
 &#x251C;&#x2500;&#x2500; providers
 &#x251C;&#x2500;&#x2500; recipes
 &#x251C;&#x2500;&#x2500; resources
 &#x2514;&#x2500;&#x2500; templates
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/05_desarrollando_con_chef/17">
<h1>Estructura de un cookbook</h1>

<ul>
<li>Los <strong>recipes</strong> se guardan en el directorio <code>recipes</code>. Y su nombre es importante:

<ul>
<li><strong>recipe[ntp::foo]:</strong> <code>mis_cookbooks/ntp/recipes/foo.rb</code></li>
<li><strong>recipe[ntp]:</strong> <code>mis_cookbooks/ntp/recipes/default.rb</code></li>
</ul></li>
<li>El nombre de un recipe debe especificar el nombre del cookbook definendo as&#xED; un <strong>namespace</strong></li>
<li>El caso <strong>recipe[ntp]</strong> es equivalente a utilizar <strong>recipe[ntp::default]</strong></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/05_desarrollando_con_chef/18">
<h1>Mi primer recipe</h1>

<p>Creamos el directorio para el <code>cookbook</code> y <code>recipe</code></p>

<pre><code><code class="command">$ mkdir -p prueba_chef/cookbooks/test/recipes</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content small" ref="01-chef-dev/05_desarrollando_con_chef/19">
<h1>Mi primer recipe</h1>

<p>Creamos el archivo <code>prueba_chef/cookbooks/test/recipes/default.rb</code> con el siguiente contenido:</p>

<pre class="sh_ruby"><code>user "ejemplo" do
  home '/home/ejemplo'
  shell '/bin/bash'
  password 'STHx70ea82L.Yw1eAha15.'
  # calculada con: 
  #   openssl passwd -1 "pass_de_ejemplo"
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental smaller" ref="01-chef-dev/05_desarrollando_con_chef/20">
<h1>Lo probamos usando Vagrant</h1>

<p>Ubicados dentro del directorio raiz <code>prueba_chef/</code> corremos</p>

<pre><code><code class="command">$ vagrant init ubuntu-1204 \
     http://vagrantbox.desarrollo.cespi.unlp.edu.ar/pub/ubuntu-12.04.2-cespi-amd64.box</code>
<code class="result">A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/05_desarrollando_con_chef/21">
<h1>Lo probamos usando Vagrant</h1>

<h2>Editamos el archivo generado</h2>

<p>El comando vagrant init cre&#xF3; un archivo a partir de un template que llam&#xF3; <code>Vagrantfile</code>. Debemos indicar qu&#xE9; IP darle a nuestra m&#xE1;quina virtual. Utilizaremos <code>33.33.33.100</code></p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
    config.vm.box = "opscode-ubuntu-1204"
    config.vm.box_url = "http://vagra..."
    config.vm.network :private_network, ip: "33.33.33.100"
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/05_desarrollando_con_chef/22">
<h1>Lo probamos usando Vagrant</h1>

<p>Ahora podemos iniciar la m&#xE1;quina con vagrant</p>

<pre><code><code class="command">$ vagrant up</code>
<code class="result">Bringing machine 'default' up with 'virtualbox' provider...
[default] Box 'opscode-ubuntu-1204' was not found. Fetching box from 
specified URL for the provider 'virtualbox'. Note that if the URL does not 
have a box for this provider, you should interrupt Vagrant now and add
the box yourself. Otherwise Vagrant will attempt to download the
full box prior to discovering this error.
Downloading or copying the box...
Extracting box...te: 4563k/s, Estimated time remaining: 0:00:01)
Successfully added box 'opscode-ubuntu-1204' with provider 'virtualbox'!
[default] Importing base box 'opscode-ubuntu-1204'...
[default] Matching MAC address for NAT networking...
[default] Setting the name of the VM...
[default] Clearing any previously set forwarded ports...
[default] Creating shared folders metadata...
[default] Clearing any previously set network interfaces...
[default] Preparing network interfaces based on configuration...
[default] Forwarding ports...
[default] -- 22 =&gt; 2222 (adapter 1)
[default] Booting VM...
[default] Waiting for VM to boot. This can take a few minutes.
[default] VM booted and ready for use!
[default] Configuring and enabling network interfaces...
[default] Mounting shared folders...
[default] -- /vagrant
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/05_desarrollando_con_chef/23">
<h1>Lo probamos usando Vagrant</h1>

<p>Nos conectamos a la consola de la m&#xE1;quina creada y verificamos los usuarios
creados:</p>

<pre><code><code class="command">$ vagrant ssh</code>
<code class="result">Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.5.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com/
Last login: Thu Jun  6 16:06:44 2013 from 10.0.2.2
vagrant@ubuntu-12:~$ getent passwd 
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/05_desarrollando_con_chef/24">
<h1>Lo probamos usando Vagrant</h1>

<h2>Probemos la receta</h2>

<p>Tenemos que editar el archivo Vagrantfile indicando que queremos aprovisionarlo
con <strong>chef</strong>. El archivo deber&#xE1; quedar:</p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
  config.vm.box = "opscode-ubuntu-1204"
  config.vm.box_url = "http://vagra..."
  config.vm.network :private_network, ip: "33.33.33.100"
  config.vm.provision :chef_solo do |chef|
    chef.cookbooks_path = "./cookbooks"
    chef.add_recipe "test"
  end
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/05_desarrollando_con_chef/25">
<h1>Lo probamos usando Vagrant</h1>

<h2>Probemos la receta</h2>

<p>Una vez editado el Vagrantfile, reiniciamos vagrant y observamos la salida.</p>

<pre><code>$ vagrant reload
[default] Attempting graceful shutdown of VM...
....
....
[default] -- /vagrant
[default] -- /tmp/vagrant-chef-1/chef-solo-1/cookbooks
[default] Running provisioner: chef_solo...
Generating chef JSON and uploading...
Running chef-solo...
stdin: is not a tty
[2013-06-06T17:06:24+00:00] INFO: *** Chef 11.4.4 ***
[2013-06-06T17:06:27+00:00] INFO: Setting the run_list to
 ["recipe[test]"] from JSON
[2013-06-06T17:06:27+00:00] INFO: Run List is [recipe[test]]
[2013-06-06T17:06:27+00:00] INFO: Run List expands to [test]
[2013-06-06T17:06:27+00:00] INFO: Starting Chef Run for
ubuntu-12.04.2-cespi-amd64
[2013-06-06T17:06:27+00:00] INFO: Running start handlers
[2013-06-06T17:06:27+00:00] INFO: Start handlers complete.
...
...
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center" ref="01-chef-dev/05_desarrollando_con_chef/26">
<p><img src="./file/01-chef-dev/guauuu.jpg" alt="Guauuuu"/>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/05_desarrollando_con_chef/27">
<h1>Verificamos que Chef hizo lo que deb&#xED;a</h1>

<p>Nos conectamos a la consola de la m&#xE1;quina creada y verificamos los usuarios
creados:</p>

<pre><code><code class="command">$ vagrant ssh</code>
<code class="result">Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.5.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com/
Last login: Thu Jun  6 16:06:44 2013 from 10.0.2.2
vagrant@ubuntu-12:~$ getent passwd 
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/05_desarrollando_con_chef/28">
<h1>Descargar el ejemplo</h1>

<h2>Para descargar el ejemplo dado</h2>

<pre><code><code class="command">$ git clone https://github.com/chrodriguez/capacitacion_chef.git</code>
<code class="command">$ cd capacitacion_chef </code>
<code class="command">$ cd samples/01-chef-dev/01-mi-primer-recipe/prueba_chef</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/06_recursos_chef/1">
<h1>Resources en Chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/06_recursos_chef/2">
<h1>Resources en Chef</h1>

<ul>
<li>Son la parte <strong>fundamental</strong> de los recipes</li>
<li>Define las acciones a tomar:

<ul>
<li>Cu&#xE1;ndo instalar un paquete</li>
<li>Cu&#xE1;ndo un servicio debe iniciarse o reiniciarse</li>
<li>Qu&#xE9; usuarios, grupos o membres&#xED;as deben crearse</li>
</ul></li>
<li>Cuando Chef corre, cada resource es identificado y asociado con un <strong>provider</strong>

<ul>
<li>El proveedor es quien realiza el trabajo que define el resource</li>
</ul></li>
<li>Chef <strong>asegura</strong> que:

<ul>
<li>Las mismas acciones son realizadas de la misma forma cada vez </li>
<li>Las acciones siempre producen los mismos resultados</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/3">
<h1>Resources en Chef</h1>

<ul>
<li>Los resources se implementan dentro de recipes usando ruby</li>
<li>Un resource representa alguna parte del sistema (y su estado deseado)

<ul>
<li>Un provider ofrece las herramientas para llevar a &#xE9;sta parte del sistema desde
su estado actual, al estado deseado</li>
</ul></li>
<li>A partir de <a href="http://docs.opscode.com/ohai.html">Ohai</a> (herramienta utilizada
para detectar propiedades de un sistema como procesador, plataforma, SO,
memoria, etc):

<ul>
<li>Chef verifica <code>platform</code> y <code>platform_version</code> para identificar el provider
adecuado </li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/06_recursos_chef/4">
<h1>Resources en Chef</h1>

<h2>Ejemplo de un resource</h2>

<pre class="sh_ruby"><code>directory "/tmp/folder" do
  owner "root"
  group "root"
  mode 0755
  action :create
end</code></pre>

<ul>
<li>Chef buscar&#xE1; el provider para <code>directory resource</code> que en este caso es
<code>Chef::Provider::Directory</code></li>
<li>En base al resource mostrado, que resulta llamarse <code>directory["/tmp/folder"]</code>

<ul>
<li>Analiza el estado actual del recurso</li>
<li>Realiza la acci&#xF3;n mencionada: <code>:create</code></li>
</ul></li>
<li>Si el directorio ya exist&#xED;a, no hace nada, sino lo crear&#xE1; con los permisos,
due&#xF1;o y grupo mencionados</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/5">
<h1>Resources en Chef</h1>

<h2>O sea...</h2>

<ul>
<li>Los recursos son parte de la DSL de Chef</li>
<li>Se van a usar de la forma mostrada con el ejemplo <code>directory</code>, como si fuesen un bloque de ruby</li>
<li>Dentro del bloque del resource, se especificar&#xE1;n los atributos que defina ese
resource</li>
<li>El provider har&#xE1; su trabajo de forma m&#xE1;gica</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/6">
<h1>Funcionalidad com&#xFA;n de todos los resources</h1>

<h2>Acciones</h2>

<ul>
<li>Todos los recursos admitir&#xE1;n acciones a trav&#xE9;s del atributo <code>action</code>.</li>
<li>Todos los resources soportan el <strong>action</strong> <code>:nothing</code>

<ul>
<li>Se utiliza para especificar que el recurso no hace nada. En ausencia de otra
acci&#xF3;n espeficada para un resource por defecto, se utiliza <code>:nothing</code> por
default</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/7">
<h1>Ejemplo de uso de action</h1>

<h2>Ejemplo de uso del action <code>:nothing</code></h2>

<pre class="sh_ruby"><code>service "memcached" do
    action :nothing
    supports {
        :status =&gt; true, 
        :start =&gt; true, 
        :stop =&gt; true, 
        :restart =&gt; true
    }
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/06_recursos_chef/8">
<h1>M&#xE1;s funcionalidad com&#xFA;n de todos los resources</h1>

<ul>
<li><code>ignore_failure</code>: utilizado para que la ejecuci&#xF3;n de un recipe contin&#xFA;e incluso ante la falla del recurso. Su valor por defecto es <code>false</code></li>
<li><code>provider</code>: utilizado para especificar el provder. Generalmente no es necesario. El nombre debe ser el nombre copleto de la clase que lo implementa. Por ejemplo: <code>provider Chef::Provider::Long::Name</code>. </li>
<li><code>retries</code>: usado para especificar el n&#xFA;mero de veces que debe catchearse excepciones y reintentar con el resource.. El valor por defecto es <code>0</code></li>
<li><code>retry_delay</code>: usado para especificar el delay de retardo entre reintentos en segundos. El valor por defecto es: <code>2</code></li>
<li><code>supports</code>: usado para especificar un Hash de opciones que contienen los <em>hints</em> sobre las capacidades del resource. Chef puede itilizar estos <em>hints</em> para ayudarse a identificar el provider adecuado. Este atributo lo utiliza una peque&#xF1;a cantidad de providers, incluyendo <em>users</em> y <em>service</em>.</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content small" ref="01-chef-dev/06_recursos_chef/9">
<h1>Ejemplo de uso de action</h1>

<h2>Ejemplo de ignore failure</h2>

<pre class="sh_ruby"><code>gem_package "syntax" do
    action :install
    ignore_failure true
end</code></pre>

<h2>Ejemplo de provider</h2>

<pre class="sh_ruby"><code>package "some_package" do
    provider Chef::Provider::Package::Rubygems
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/10">
<h1>Ejecuci&#xF3;n condicional</h1>

<ul>
<li>La ejecuci&#xF3;n condicional permite agregar guardas a la ejecuci&#xF3;n de un resource</li>
<li>Esto permite agergar condiciones antes de ejecutar el resource</li>
<li>La raz&#xF3;n de ser de esto, es que debemos garantizar que la ejecuci&#xF3;n de un resource <strong>siempre</strong> produce el mismo resultado</li>
<li>La condici&#xF3;n podr&#xE1; pasarse como <strong>string</strong> o como <strong>bloque</strong>

<ul>
<li><strong>strings:</strong> se ejecutan como un comando de shell</li>
<li><strong>bloques:</strong> se ejecutan como c&#xF3;digo Ruby</li>
</ul></li>
<li>En el caso de strings el atributo ser&#xE1; <code>true</code> cuando retorne <code>0</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="01-chef-dev/06_recursos_chef/11">
<h1>Ejecuci&#xF3;n condicional</h1>

<ul>
<li>Atributos que permiten la ejecuci&#xF3;n condicional

<ul>
<li><code>not_if</code></li>
<li><code>only_if</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="01-chef-dev/06_recursos_chef/12">
<h1>Ejecuci&#xF3;n condicional</h1>

<ul>
<li>En ambos casos, es posible utilizar argumentos:

<ul>
<li><code>:user</code>: usado para especificar el usuario con el que se correr&#xE1; el comando a evaluar</li>
<li><code>:group:</code>: igual que el anterior, pero aplica al grupo</li>
<li><code>:environment</code>: un hash de variables de ambiente que ser&#xE1;n seteadas</li>
<li><code>:cwd</code>: setea el path donde se correr&#xE1; el comando</li>
<li><code>:timeout</code>: para setear un timeout para el comando</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content small" ref="01-chef-dev/06_recursos_chef/13">
<h1>Ejecuci&#xF3;n condicional</h1>

<h2>Ejemplo de uso de argumentos</h2>

<pre class="sh_ruby"><code>    not_if "grep adam /etc/passwd", :user =&gt; 'adam'

    not_if "grep adam /etc/passwd", :group =&gt; 'adam'

    not_if "grep adam /etc/passwd", {
        :environment =&gt; { 'HOME' =&gt; "/home/adam" }
    }

    not_if "grep adam passwd", :cwd =&gt; '/etc'

    not_if "sleep 10000", :timeout =&gt; 10</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content small" ref="01-chef-dev/06_recursos_chef/14">
<h1>Ejecuci&#xF3;n condicional</h1>

<h2>Ejemplo de ejecuci&#xF3;n condicional completo</h2>

<pre class="sh_ruby"><code>template "/tmp/somefile" do
    mode 00644
    source "somefile.erb"
    not_if {File.exists?("/etc/passwd")}
end

template "/tmp/somefile" do
    mode 00644
    source "somefile.erb"
    not_if "test -f /etc/passwd"
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets small" ref="01-chef-dev/06_recursos_chef/15">
<h1>Notificaciones</h1>

<p>Permite que los resources se notifiquen o suscriban a ser notificados de cambios
en otros resources</p>

<ul>
<li>Cualquier resource puede utilizar las siguientes notificaciones

<ul>
<li><code>notifies</code>: utilizado para notificar a otros resources cambios </li>
<li><code>subscribes</code>:  utilizado para ser notificado ante cambios en otros resources</li>
</ul></li>
<li>Pueden utilizarse timers

<ul>
<li><code>delayed</code>: indica que la notificaci&#xF3;n ser&#xE1; encolada i ejecutada al final de
la cola de tareas a realizar po el Chef run </li>
<li><code>immediately</code>: indica que la notificaci&#xF3;n deber&#xE1; correrse inmediatamente</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/06_recursos_chef/16">
<h1>Notificaciones</h1>

<h2>La sintaxis</h2>

<pre class="sh_ruby"><code>resource "name" do
    notifies :action, "res_type[res_name]", :notif_timing
end

resource "name" do
    subscribes :action, "res_type[res_name]", :notif_timing
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/06_recursos_chef/17">
<h1>Notificaciones</h1>

<h2>Ejemplo de reiniciar un servicio</h2>

<pre class="sh_ruby"><code>template "/etc/www/configures-apache.conf" do
    notifies :restart, "service[apache]"
end</code></pre>

<h2>Ejemplo de notificar varios</h2>

<pre class="sh_ruby"><code>template "/etc/chef/server.rb" do
    source "server.rb.erb"
    owner "root"
    group "root"
    mode "644"
    notifies :restart, "service[chef-solr]", :delayed
    notifies :restart, "service[chef-solr-indexer]", :delayed
    notifies :restart, "service[chef-server]", :delayed
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/06_recursos_chef/18">
<h1>Resources disponibles</h1>

<ul>
<li>apt_packages</li>
<li>bash</li>
<li>breakpoint</li>
<li>chef_gem</li>
<li>cookbook_file</li>
<li>cron</li>
<li>csh</li>
<li>deploy</li>
<li>directory</li>
<li>dpkg_package</li>
<li>easy<em>install</em>package</li>
<li>env</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/06_recursos_chef/19">
<h1>Resources disponibles</h1>

<ul>
<li>erl_call</li>
<li>execute</li>
<li>file</li>
<li>freebsd_package</li>
<li>gem_package</li>
<li>git</li>
<li>group</li>
<li>htt_request</li>
<li>ifconfig</li>
<li>ips_package</li>
<li>link</li>
<li>log</li>
<li>macports_package</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/06_recursos_chef/20">
<h1>Resources disponibles</h1>

<ul>
<li>mdmadm</li>
<li>mount</li>
<li>ohai</li>
<li>package</li>
<li>pacman</li>
<li>perl</li>
<li>portage_package</li>
<li>powershell_script</li>
<li>python</li>
<li>registry_key</li>
<li>remote_directory</li>
<li>remote_file</li>
<li>route</li>
<li>rpm_package</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/06_recursos_chef/21">
<h1>Resources disponibles</h1>

<ul>
<li>ruby</li>
<li>ruby_block</li>
<li>scm</li>
<li>script</li>
<li>service</li>
<li>smartos_package</li>
<li>solaris_package</li>
<li>subversion</li>
<li>template</li>
<li>user</li>
<li>yum_package</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/06_recursos_chef/22">
<h1>Resources disponibles</h1>

<h2>Documentaci&#xF3;n disponible en:</h2>

<p><a href="http://docs.opscode.com/resource.html">http://docs.opscode.com/resource.html</a></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/07_atributos_chef/1">
<h1>Attributes en Chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets small" ref="01-chef-dev/07_atributos_chef/2">
<h1>Attributes</h1>

<ul>
<li>Los <em>attributes</em> son un detalle espec&#xED;fico de un nodo. Chef utiliza los attributes para entender:

<ul>
<li>El estado actual de un nodo</li>
<li>Cu&#xE1;l era el estado del nodo al finalizar la anterior corrida de Chef</li>
<li>Cu&#xE1;l deber&#xED;a de ser el estado del nodo al finalizar la corrida de Chef</li>
</ul></li>
<li>Los attributes son definidos por:

<ul>
<li>El estado mismo del nodo</li>
<li>Cookbooks: mediante archivos en el directorio <code>attributes/</code> y/o recipes</li>
<li>Roles</li>
<li>Environments</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets small" ref="01-chef-dev/07_atributos_chef/3">
<h1>Attributes</h1>

<ul>
<li>Durante cada corrida de Chef, <code>chef-client</code> arma la lista de attributes
usando:

<ul>
<li>Datos recolectados de <em>ohai</em></li>
<li>El objeto <code>node</code> guardado en Chef Server al finalizar la corrida previa
de Chef</li>
<li>La reconstrucci&#xF3;n del objeto <code>node</code> para la actual corrida de Chef, luego de
actualizar cookbooks (mediante los archivos en el directorio <code>attributes/</code>
y/o recipes), roles, environments, y actualizaciones de cualquier estado en el
mismo <code>node</code> (por ejemplo ohai)</li>
</ul></li>
</ul>

<p>Una vez reconstru&#xED;do el objeto <code>node</code>, todos los attributes son comparados y
actualizados siguiendo las reglas de precedencia.</p>

<p>Al finalizar la corrida de Chef, el objeto <code>node</code> que define el estado actual
del mismo es subido al Chef Server con la finalidad de indexarlo y as&#xED; permitir
b&#xFA;squedas.</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/07_atributos_chef/4">
<h1>Attribute Types</h1>

<ul>
<li><code>default</code>: estos atributos son resetados al iniciar cada corrida de Chef y
tienen la menor precedencia. Un cookbook debe crearse utilizando tantos atributos por
defecto como sea posible, sin dejar atributos sin valor.</li>
<li><code>force_default</code>: estos atributos son usados para <em>asegurar</em> que un atributo definido en un
cookbook (mediante archivos en el directorio <code>attributes</code> y/o recipes) toma
precedencia sobre el atributo <code>default</code> definido por un <em>role</em> o <em>environment</em></li>
<li><code>normal</code>: estos atributos son seteos que persisten en el sistema destino y
nunca son reseteados por una corrida de Chef. Los atributos <code>normal</code> tienen
mayor precedencia que los <code>default</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/07_atributos_chef/5">
<h1>Attribute Types</h1>

<ul>
<li><code>override</code>: estos atributos son autom&#xE1;ticamente reseteados al inicio de cada
corrida de Chef, y tiene mayor precedencia que los atributos <code>default</code>,
<code>force_default</code> y <code>normal</code>. Son <em>mayormente</em> utilizados en recipes, pero pueden
especificarse en archivos de <code>attributes</code>, <em>roles</em> o <em>environments</em>. Un cookbook
debe utilizar este tipo de atributos <em>s&#xF3;lo cuando sea necesario</em>.</li>
<li><code>force_override</code>: estos atributos son usados para <em>asegurar</em> que un atributo
definido en un cookbook (mediante archivos en el directorio <code>attributes</code> y/o recipes) toma
precedencia sobre el atributo <code>override</code> definido por un <em>role</em> o <em>environment</em></li>
<li><code>automatic</code>: estos atributos contienen datos identificados por <em>Ohai</em> al
inicio de cada corrida de Chef. Un atributo <code>automatic</code> no puede modificarse y
<em>siempre</em> tiene la precedencia m&#xE1;s alta</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/07_atributos_chef/6">
<h1>Attribute Types</h1>

<p>Al inicio de cada corrida de Chef, se <em>resetean</em> todos los atributos <code>default</code>, <code>override</code> y
<code>automatic</code>. </p>

<p>Chef reconstruir&#xE1; los atributos recolectando informaci&#xF3;n de <em>Ohai</em>
al inicio de cada corrida de Chef, y atributos definidos en el cookbook, roles
y/o environments.</p>

<p>Los atributos <code>normal</code> <em>nunca son resetados</em></p>

<p>Luego todos los atributos se mezclan y aplican al node de acuerdo a la
precedencia de atributos.</p>

<p>Al finalizar la corrida de Chef, todos los atributos <code>default</code>, <code>override</code> y
<code>automatic</code> desaparecen, dejando s&#xF3;lo la colecci&#xF3;n de atributos <code>normal</code> que
persistir&#xE1;n hasta la pr&#xF3;xima corrida de Chef.</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="01-chef-dev/07_atributos_chef/7">
<h1>Or&#xED;genes de Attributes</h1>

<ul>
<li>Los atributos son provistos a Chef desde los siguientes or&#xED;genes:

<ul>
<li>Nodes, a trav&#xE9;s de Ohai al inicio de cada corrida</li>
<li>Archivos bajo el directorio <code>attributes</code> dentro de cookbooks</li>
<li>Recipes dentro de cookbooks</li>
<li>Environments</li>
<li>Roles</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center" ref="01-chef-dev/07_atributos_chef/8">
<h1>Or&#xED;genes de Attributes</h1>

<p><img src="./file/01-chef-dev/topologia-chef-atributos.png" alt="Chef origenes"/>
</p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content bullets" ref="01-chef-dev/07_atributos_chef/9">
<h1>Automatic (Ohai)</h1>

<ul>
<li>Algunos valores com&#xFA;nmente usados:

<ul>
<li><code>node['platform']</code></li>
<li><code>node['platform_version']</code></li>
<li><code>node['ipaddress']</code></li>
<li><code>node['macaddress']</code></li>
<li><code>node['fqdn']</code></li>
<li><code>node['hostname']</code></li>
<li><code>node['domain']</code></li>
<li><code>node['recipes']</code></li>
<li><code>node['roles']</code></li>
<li><code>node['ohai_time']</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/07_atributos_chef/10">
<h1>Automatic (Ohai)</h1>

<pre><code><code class="command">$ chef-shell</code>
<code class="result">chef &gt; node[:platform]
  =&gt; "ubuntu" 

chef &gt; node[:platform_version]
  =&gt; "12.04" 

chef &gt; Time.at(node[:ohai_time])
  =&gt; ...
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/07_atributos_chef/11">
<h1>Archivo de Attributes</h1>

<ul>
<li>Estos archivos existe en el subdirectorio <code>attributes/</code> de un cookbook</li>
<li>Cuando un cookbook es ejecutado en un nodo, los atributos contenidos en 
todos los archivos bajo este subdirectorio son evaluados en el contexto del
objeto <em>node</em>.</li>
<li>Si est&#xE1;n presentes, los m&#xE9;todos de un nodo son utilizados para setear los
atributos del nodo. </li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content small" ref="01-chef-dev/07_atributos_chef/12">
<h1>Archivo de Attributes</h1>

<p>Por ejemeplo, el cookbook <em>Apache</em> contiene un archivo de attribute llamado <code>default.rb</code> que contiene atributos como:</p>

<pre class="sh_ruby"><code>default["apache"]["dir"]          = "/etc/apache2"
default["apache"]["listen_ports"] = [ "80","443" ]</code></pre>

<p>En este ejemplo, el uso del objeto node est&#xE1; impl&#xED;cito. En el siguiente ejemplo
utiliza el objeto node:</p>

<pre class="sh_ruby"><code>node.default["apache"]["dir"]         = "/etc/apache2"
node.default["apache"]["listen_ports"]= ["80", "443"]</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/07_atributos_chef/13">
<h1>Precedencia de Attributes</h1>

<ol>
<li>Un <code>default</code> attribute ubicado en un archivo attributes</li>
<li>Un <code>default</code> attribute ubicado en un recipe </li>
<li>Un <code>default</code> attribute ubicado en un environment</li>
<li>Un <code>default</code> attribute ubicado en un role</li>
<li>Un <code>force_default</code> attribute ubicado en un archivo attributes</li>
<li>Un <code>force_default</code> attribute ubicado en un recipe</li>
<li>Un <code>normal</code> attribute ubicado en un archivo attributes</li>
<li>Un <code>normal</code> attribute ubicado en un recipe</li>
<li>Un <code>override</code> attribute ubicado en un archivo attributes</li>
<li>Un <code>override</code> attribute ubicado en un recipe</li>
<li>Un <code>override</code> attribute ubicado en un role</li>
<li>Un <code>override</code> attribute ubicado en un environment</li>
<li>Un <code>force_override</code> attribute ubicado en un archivo attributes</li>
<li>Un <code>force_override</code> attribute ubicado en un recipe</li>
<li>Un <code>automatic</code> attribute identificado por ohai al inicio de una corrida Chef</li>
</ol>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/07_atributos_chef/14">
<h1>Precedencia de Attributes</h1>

<p>El orden de precedencia de atributos para <em>roles</em> y <em>environments</em> se invierte
para atributos <code>default</code>y <code>override</code>:</p>

<ul>
<li>Para <code>default</code>, el orden de precedencia es: environment, role</li>
<li>Para <code>override</code>, el orden de precedencia es: role, environment</li>
</ul>

<p><em>Aplicando los atributos <code>override</code> del environment</em> <strong><em>luego</em></strong> <em>de los roles
permite que los roles existan en m&#xFA;ltiples environments</em></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/07_atributos_chef/15">
<h1>Ejemplo de attributes</h1>

<h2>Ejemplos ordenados de menor a mayor precedencia</h2>

<p>Default attribute en <code>/attributes/default.rb</code></p>

<pre class="sh_ruby"><code>default["apache"]["dir"] = "/etc/apache2"</code></pre>

<p>Default attribute en <code>/environments/environment_name.rb</code></p>

<pre class="sh_ruby"><code>default_attributes({ "apache" =&gt; {"dir" =&gt; "/etc/apache2"}})</code></pre>

<p>Default attribute en <code>/roles/role_name.rb</code></p>

<pre class="sh_ruby"><code>default_attributes({ "apache" =&gt; {"dir" =&gt; "/etc/apache2"}})</code></pre>

<p>Default attribute en objeto <code>node</code> en una recipe</p>

<pre class="sh_ruby"><code>node.default["apache"]["dir"] = "/etc/apache2"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/07_atributos_chef/16">
<h1>Ejemplo de attributes</h1>

<h2>Ejemplos ordenados de menor a mayor precedencia</h2>

<p>Normal attribute seteado en un cookbook mediante <code>/attributes/default.rb</code></p>

<pre class="sh_ruby"><code>set["apache"]["dir"] = "/etc/apache2"
normal["apache"]["dir"] = "/etc/apache2"  
    #set alias de normal</code></pre>

<p>Normal attribute seteado en un <code>recipe</code></p>

<pre class="sh_ruby"><code>node.set["apache"]["dir"] = "/etc/apache2"
node.normal["apache"]["dir"] = "/etc/apache2" # idem ant
node["apache"]["dir"] = "/etc/apache2"        # idem ant</code></pre>

<p>Override attribute en <code>/attributes/default.rb</code></p>

<pre class="sh_ruby"><code>override["apache"]["dir"] = "/etc/apache2"</code></pre>

<p>Override attribute en <code>/roles/role_name.rb</code></p>

<pre class="sh_ruby"><code>override_attributes({ "apache" =&gt; {"dir" =&gt; "/etc/apache2"}})</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/07_atributos_chef/17">
<h1>Ejemplo de attributes</h1>

<h2>Ejemplos ordenados de menor a mayor precedencia</h2>

<p>Override attribute en <code>/environments/environment_name.rb</code></p>

<pre class="sh_ruby"><code>override_attributes({ "apache" =&gt; {"dir" =&gt; "/etc/apache2"}})</code></pre>

<p>Override attribute en objeto <code>node</code> (de un recipe)</p>

<pre class="sh_ruby"><code>node.override["apache"]["dir"] = "/etc/apache2"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/07_atributos_chef/18">
<h1>Modificando la precedencia de attributes default</h1>

<p>Cuando un default attribute es setado as&#xED;:</p>

<pre class="sh_ruby"><code>default["attribute"] = "value"</code></pre>

<p>cualquier valor seteado por un role o environment lo reemplazar&#xE1;. Para prevenir
este remplazo, podemos utilizar <code>force_default</code>:</p>

<pre class="sh_ruby"><code>force_default["attribute"] = "I will crush you, role or " +
    "environment attribute"

# o es posible usar:

default!["attribute"] = "The '!' means I win!"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/07_atributos_chef/19">
<h1>Modificando la precedencia de attributes override</h1>

<p>Cuando un override attribute es seteado as&#xED;:</p>

<pre class="sh_ruby"><code>override["attribute"] = "value"</code></pre>

<p>cualquier valor seteado por un rol o environment lo reemplazar&#xE1;. Para prevenir
este reemplazo, podemos utilizar <code>force_override</code>:</p>

<pre class="sh_ruby"><code>force_override["attribute"] = "I will crush you, role or "+
    "environment attribute"

# o es posible usar:

override!["attribute"] = "The '!' means I win!"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/08_ntp/1">
<h1>NTP con chef</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/08_ntp/2">
<h1>NTP con chef</h1>

<h2>Creamos el cookbook</h2>

<pre><code><code class="command">$ mkdir -p cookbooks/ntp </code>
</code></pre>

<h2>Creamos el recipe</h2>

<pre><code><code class="command">$ mkdir -p cookbooks/ntp/recipes</code>
<code class="command">$ vi cookbooks/ntp/recipes/default.rb</code>
</code></pre>

<p><em>Es aconsejable tener una receta para <code>server.rb</code> y otra para <code>client.rb</code> en
este caso, pero por cuestiones de simplicidad, utilizamos &#xFA;nicamente el recipe <code>default.rb</code></em></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/08_ntp/3">
<h1>&#xBF;Qu&#xE9; deber&#xED;amos hacer?</h1>

<ul>
<li>Instalar el paquete de NTP</li>
<li>Configurar <code>/etc/ntp.conf</code></li>
<li>Habilitar el servicio para que bootee e iniciar el servicio</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/08_ntp/4">
<h1>El recipe</h1>

<p>En la edici&#xF3;n de <code>recipes/default.rb</code> tendr&#xED;amos:</p>

<pre class="sh_ruby"><code>package 'ntp'

template '/etc/ntp.conf' do
    source    'ntp.conf.erb'
    notifies  :restart, 'service[ntp]'
end

service 'ntp' do
    action [:enable, :start]
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets incremental" ref="01-chef-dev/08_ntp/5">
<h1>&#xBF;C&#xF3;mo se usa el resource template?</h1>

<ul>
<li>&#xBF;Qu&#xE9; es el formato erb?</li>
<li>&#xBF;C&#xF3;mo uso variables en el template?</li>
<li>&#xBF;Pueden haber diferentes versiones del mismo template?</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/08_ntp/6">
<h1>El template para ntp</h1>

<p>El template <code>/etc/ntp.conf</code> debemos crearlo en el directorio <code>templates/default</code>
de mi cookbook con el nombre <code>ntp.conf.erb</code> porque es lo que indicamso en la
recipe <code>default.rb</code> anteriormente:</p>

<pre><code><code class="command">$ mkdir -p cookbooks/ntp/templates/default</code>
<code class="command">$ vi cookbooks/ntp/templates/default/ntp.conf.erb</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/08_ntp/7">
<h1>El template para ntp</h1>

<pre class="sh_ruby"><code># This file was generated by Chef for '&lt;%= node['fqdn'] %&gt;'.
# Do NOT edit this file by hand!

restrict default kod nomodify notrap nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery
restrict 127.0.0.1
restrict -6 ::1
server &lt;%= node[:ntp][:server]%&gt;
server  127.127.1.0     # local clock
driftfile /var/lib/ntp/drift
keys /etc/ntp/keys</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/08_ntp/8">
<h1>Nos quedar&#xED;a definir los atributos usados</h1>

<ul>
<li>Los valores usados en el template son atributos, a decir:

<ul>
<li><code>node['fqdn']</code>: valor provisto por ohai</li>
<li><code>node[:ntp][:server]</code>: valor provisto por este cookbook. <strong>Hay que definirlo</strong></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline" ref="01-chef-dev/08_ntp/9">
<h1>Attributes ntp</h1>

<p>Editamos <code>attributes/default.rb</code></p>

<pre><code><code class="command">$ mkdir  -p cookbooks/ntp/attributes</code>
<code class="command">$ vi cookbooks/ntp/attributes/default.rb</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content" ref="01-chef-dev/08_ntp/10">
<h1>Attributes ntp</h1>

<pre class="sh_ruby"><code>default[:ntp][:server] = '0.pool.ntp.org'</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline smaller incremental" ref="01-chef-dev/08_ntp/11">
<h1>Probando la receta ntp</h1>

<p>Inicializamos <code>vagrant</code> en el directorio en el que estamos trabajando. Considere
que ser&#xED;a el directorio donde se encuentra el directorio <code>cookbooks</code> en el cu&#xE1;l
creamos el cookbook <code>ntp</code>. </p>

<pre><code><code class="command">$ vagrant init ubuntu-1204 \
    http://vagrantbox.desarrollo.cespi.unlp.edu.ar/pub/ubuntu-12.04.2-cespi-amd64.box</code>
<code class="result">    A `Vagrantfile` has been placed in this directory. You are now
    ready to `vagrant up` your first virtual environment! Please read
    the comments in the Vagrantfile as well as documentation on
    `vagrantup.com` for more information on using Vagrant.
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/08_ntp/12">
<h1>Probando la receta ntp</h1>

<p>Editamos <code>Vagrantfile</code> indicando que usaremos chef con la receta de ntp, quedando nuestro archivo:</p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
    config.vm.box = "ubuntu-1204"
    config.vm.box_url = "http://vagrantbo......"
    config.vm.network :private_network, ip: "192.168.33.10"
    config.vm.provision :chef_solo do |chef|
         chef.cookbooks_path = "cookbooks"
         chef.add_recipe "ntp"
    end
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental smaller" ref="01-chef-dev/08_ntp/13">
<pre><code><code class="command">$ vagrant up</code>
<code class="result">Bringing machine 'default' up with 'virtualbox' provider...
[default] Importing base box 'ubuntu-1204'...
[default] Matching MAC address for NAT networking...
[default] Setting the name of the VM...
[default] Forwarding ports...
[default] -- 22 =&gt; 2222 (adapter 1)
[default] Booting VM...
[default] Waiting for VM to boot. This can take a few minutes.
[default] VM booted and ready for use!
[default] Configuring and enabling network interfaces...
[default] Mounting shared folders...
[default] -- /vagrant
[default] -- /tmp/vagrant-chef-1/chef-solo-1/cookbooks
[default] Running provisioner: chef_solo...
Generating chef JSON and uploading...
Running chef-solo...
stdin: is not a tty
[2013-06-13T13:11:43+00:00] INFO: *** Chef 11.4.4 ***
[2013-06-13T13:11:45+00:00] INFO: Setting the run_list to ["recipe[ntp]"] from
JSON
[2013-06-13T13:11:45+00:00] INFO: Run List is [recipe[ntp]]
[2013-06-13T13:11:45+00:00] INFO: Run List expands to [ntp]
[2013-06-13T13:11:45+00:00] INFO: Starting Chef Run for
ubuntu-12.04.2-cespi-amd64
[2013-06-13T13:11:45+00:00] INFO: Running start handlers
[2013-06-13T13:11:45+00:00] INFO: Start handlers complete.
[2013-06-13T13:11:45+00:00] INFO: Processing package[ntp] action install
(ntp::default line 1)
[2013-06-13T13:11:45+00:00] INFO: Processing template[/etc/ntp.conf] action
create (ntp::default line 3)
[2013-06-13T13:11:46+00:00] INFO: template[/etc/ntp.conf] backed up to
/var/chef/backup/etc/ntp.conf.chef-20130613131145
[2013-06-13T13:11:46+00:00] INFO: template[/etc/ntp.conf] updated content
[2013-06-13T13:11:46+00:00] INFO: Processing service[ntp] action enable
(ntp::default line 8)
[2013-06-13T13:11:46+00:00] INFO: Processing service[ntp] action start
(ntp::default line 8)
[2013-06-13T13:11:46+00:00] INFO: template[/etc/ntp.conf] sending restart action
to service[ntp] (delayed)
[2013-06-13T13:11:46+00:00] INFO: Processing service[ntp] action restart
(ntp::default line 8)
[2013-06-13T13:11:47+00:00] INFO: service[ntp] restarted
[2013-06-13T13:11:47+00:00] INFO: Chef Run complete in 2.319794345 seconds
[2013-06-13T13:11:47+00:00] INFO: Running report handlers
[2013-06-13T13:11:47+00:00] INFO: Report handlers complete
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline small" ref="01-chef-dev/08_ntp/14">
<h1>Verificamos todo</h1>

<p>Conectamos por ssh: <code>vagrant ssh</code></p>

<p>Analizar el template generado: <code>cat /etc/ntp.conf</code></p>

<p>Usar el cliente de ntp:</p>

<pre><code><code class="command">$ ntpq -c peers</code>
<code class="result">         remote           refid      st t when poll reach   delay   offset  jitter
    ==============================================================================
     66.60.22.202    105.134.105.216  4 u   12   64    3   10.850   10.758   1.087
    *LOCAL(0)        .LOCL.           5 l   11   64    3    0.000    0.000   0.031
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/08_ntp/15">
<h1>Personalizamos el nodo</h1>

<p>Editamos <code>Vagrantfile</code> cambiando el <code>attribute</code> provisto por nuestro cookbook al
ntp de cespi</p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
    config.vm.box = "ubuntu-1204"
    config.vm.box_url = "http://vagrantbo......"
    config.vm.network :private_network, ip: "192.168.33.10"
    config.vm.provision :chef_solo do |chef|
         chef.cookbooks_path = "cookbooks"
         chef.add_recipe "ntp"
         chef.json = {&#xB7;
        :ntp =&gt; {
            :server =&gt; "cronos.unlp.edu.ar"
        }
    }
    end
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline small" ref="01-chef-dev/08_ntp/16">
<h1>Verificamos todo</h1>

<p>Conectamos por ssh: <code>vagrant ssh</code></p>

<p>Analizar el template generado: <code>cat /etc/ntp.conf</code></p>

<p>Usar el cliente de ntp:</p>

<pre><code><code class="command">$ ntpq -c peers</code>
<code class="result">         remote           refid      st t when poll reach   delay   offset  jitter
    ==============================================================================
     163.10.0.84     163.10.43.120    2 u   17   64    1   10.061    8.278   0.008
    *LOCAL(0)        .LOCL.           5 l   16   64    1    0.000    0.000   0.008
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/08_ntp/17">
<h1>La decepci&#xF3;n</h1>

<ul>
<li>Ingresamos a <a href="http://community.opscode.com">http://community.opscode.com</a>

<ul>
<li><a href="http://community.opscode.com/cookbooks/ntp">El caso de NTP</a></li>
</ul></li>
<li>Siempre hay que buscar si lo que necesitamos ya existe

<ul>
<li>Buscar tambi&#xE9;n en google</li>
<li>Considerar el espacio en <a href="https://github.com/opscode-cookbooks/">github de opscode</a></li>
</ul></li>
<li>Muchas veces lo que existe debe modificarse

<ul>
<li>Usemos el workflow propuesto por github forkeando el repositorio</li>
<li>Si mejoramos funcionalidad contribuimos</li>
</ul></li>
<li>Algunas reglas que seguir:

<ul>
<li><a href="http://docs.opscode.com/community_guidelines.html">Gu&#xED;as de la comunidad</a></li>
<li><a href="http://wiki.opscode.com/display/chef/How+to+Contribute+to+Opscode+Cookbooks">Contribuir con los cookbooks de Opscode</a></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/08_ntp/18">
<h1>Descargar el ejemplo</h1>

<h2>Para descargar el ejemplo dado</h2>

<pre><code><code class="command">$ git clone https://github.com/chrodriguez/capacitacion_chef.git</code>
<code class="command">$ cd capacitacion_chef </code>
<code class="command">$ cd samples/01-chef-dev/02-ntp</code>
</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/08_ntp/19">
<h1>Un cookbook m&#xE1;s</h1>

<ul>
<li>Hagamos una nueva receta que cree una base de datos <strong>mysql</strong>  y un usuario que pueda
conectarse</li>
<li>Buscamos qu&#xE9; cookbooks nos resuelven el problema</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/08_ntp/20">
<h1>Un cookbook m&#xE1;s</h1>

<ul>
<li>El cookbook que nos resuelve nuestra necesidad es <a href="https://github.com/opscode-cookbooks/database">database</a></li>
<li>Este cookbook depende de:

<ul>
<li>mysql</li>
<li>postgresql</li>
<li>xfs</li>
<li>aws</li>
</ul></li>
<li>Que a su vez dependen de otros cookbooks:

<ul>
<li>openssl</li>
<li>build-essential</li>
</ul></li>
<li><strong>&#xBF;C&#xF3;mo descargamos estos cookbooks bajo la carpeta <code>cookbooks/</code> en nuestra nueva receta?</strong></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content subsection center" ref="01-chef-dev/09_berkshelf/1">
<h1>Berkshelf</h1>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/09_berkshelf/2">
<h1>Berkshelf</h1>

<ul>
<li>Es como <code>bundler</code> a <code>ruby</code> y el manejo de <code>gems</code>

<ul>
<li>Pero de <code>cookbooks</code> a <code>chef</code></li>
</ul></li>
<li>En vez de usar <code>Gemfile</code> usa <code>Berksfile</code></li>
<li>La gema <code>berkshelf</code> instala el comando <code>berks</code> que simplifica las tareas</li>
<li>Se instala con: <code>gem install berkshelf</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/09_berkshelf/3">
<h1>berks cookbook NAME</h1>

<p>La forma en que m&#xE1;s usaremos berkshelf es creando los cookbooks directamente con
el comando <code>berks</code></p>

<pre><code><code class="command">$ berks cookbook my_database</code>
<code class="result">    create  my_database/files/default
    create  my_database/templates/default
    create  my_database/attributes
    create  my_database/definitions
    create  my_database/libraries
    create  my_database/providers
    create  my_database/recipes
    create  my_database/resources
    create  my_database/recipes/default.rb
    create  my_database/metadata.rb
    create  my_database/LICENSE
    create  my_database/README.md
    create  my_database/Berksfile
    create  my_database/chefignore
    create  my_database/.gitignore
       run  git init from "./my_database"
    create  my_database/Gemfile
    create  my_database/Vagrantfile
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/09_berkshelf/4">
<h1>berks cookbook NAME</h1>

<ul>
<li>Analizamos dos archivos:

<ul>
<li><code>Vagrantfile</code></li>
<li><code>Berksfile</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/09_berkshelf/5">
<h1>Vagrantfile</h1>

<p>El archivo <code>Vagrantfile</code> creado por <code>berks</code> toma valores por defecto:</p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
    config.vm.hostname = "my_database-berkshelf"
    config.vm.box = "Berkshelf-CentOS-6.3-x86_64-minimal"
    config.vm.box_url = "https://dl.dropbox.com.."
    config.vm.network :private_network, ip: "33.33.33.10"
    config.ssh.max_tries = 40
    config.ssh.timeout   = 120
    config.berkshelf.enabled = true
    config.vm.provision :chef_solo do |chef|
        chef.json = {
            :mysql =&gt; {
                :server_root_password =&gt; 'rootpass',
                :server_debian_password =&gt; 'debpass',
                :server_repl_password =&gt; 'replpass'
            }
        }

        chef.run_list = [
                "recipe[my_database::default]"
        ]
    end
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental small" ref="01-chef-dev/09_berkshelf/6">
<h1>Vagrantfile</h1>

<p>Podemos parametrizar la configuraci&#xF3;n por defecto de los <code>Vagrantfile</code> usando:</p>

<pre><code><code class="command">$ berks configure</code>
<code class="result">Enter value for chef.chef_server_url (default: 'http://localhost:4000'):  
Enter value for chef.node_name (default: 'latitud'):  
Enter value for chef.client_key (default: '/etc/chef/client.pem'):  
Enter value for chef.validation_client_name (default: 'chef-validator'):  
Enter value for chef.validation_key_path (default: '/etc/chef/validation.pem'):  
Enter value for vagrant.vm.box (default: 'Berkshelf-CentOS-6.3-x86_64-minimal'):  
Enter value for vagrant.vm.box_url (default: 'https://dl.dr...'):  
Config written to: '/home/user/.berkshelf/config.json'
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/09_berkshelf/7">
<h1>Mi .berksfile/config.json</h1>

<h2><code>~/.berksfile/config.json</code></h2>

<pre class="sh_json"><code>{
    "chef": {...}, 
    "cookbook": {
            "copyright": "CeSPI - UNLP", 
            "email": "car@cespi.unlp.edu.ar", 
            "license": "MIT"
    }, 
    "ssl": {
            "verify": true
    }, 
    "vagrant": {
            "vm": {
                "box": "ubuntu-12.04.2-cespi-amd64", 
                "box_url": "http://vagrantbox.desarrollo..",
                "forward_port": {}, 
                "network": {
                    "bridged": false, 
                    "hostonly": "33.33.33.10"
                    }, 
                "provision": "chef_solo"
            }
    }
}</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smaller" ref="01-chef-dev/09_berkshelf/8">
<h1>Berksfile</h1>

<p>El archivo <code>Berksfile</code> inicialmente tiene el siguiente contenido:</p>

<pre class="sh_ruby"><code>site :opscode

metadata</code></pre>

<p>Donde la palabra <code>metadata</code> indica que deben analizarse las dependencias desde
el archivo <code>metadata.rb</code> del cookbook como se se muestra a continuaci&#xF3;n:</p>

<pre class="sh_ruby"><code>name             "my_database"
maintainer       "CeSPI - UNLP"
maintainer_email "car@cespi.unlp.edu.ar"
license          "All rights reserved"
description      "Installs/Configures my_database"
long_description IO.read(File.join(File.dirname(__FILE__),
'README.md'))
version          "0.1.0"

depends "database"</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/09_berkshelf/9">
<h1>Berksfile</h1>

<pre><code><code class="command">$ berks list</code>
<code class="result">    Cookbooks installed by your Berksfile:
        * aws (0.100.4)
        * build-essential (1.3.2)
        * database (1.4.0)
        * my_database (0.1.0)
        * mysql (2.1.0)
        * openssl (1.0.0)
        * postgresql (2.1.0)
        * xfs (1.1.0)
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/09_berkshelf/10">
<h1>Berksfile</h1>

<p>Si queremos especificar versiones espec&#xED;ficas de un cookbook, podemos utilizar
sino la sintaxis del <code>Berksfile</code> que se muestra a continuaci&#xF3;n:</p>

<pre class="sh_ruby"><code>site :opscode

metadata
cookboolk 'database', '~&gt; 1.2.0'</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content commandline incremental" ref="01-chef-dev/09_berkshelf/11">
<h1>Berksfile</h1>

<pre><code><code class="command">$ berks list</code>
<code class="result">Cookbooks installed by your Berksfile:
    * aws (0.100.4)
    * build-essential (1.3.2)
    * database (1.3.12)
    * my_database (0.1.0)
    * mysql (2.1.0)
    * openssl (1.0.0)
    * postgresql (2.1.0)
    * xfs (1.1.0)
</code></code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets" ref="01-chef-dev/09_berkshelf/12">
<h1>Retomamos el ejemplo del cookbook my_database</h1>

<ul>
<li>Repetimos el objetivo de este cookbook: <em>Hagamos una nueva receta que cree una base de datos</em> <strong>mysql</strong>  <em>y un usuario que pueda conectarse</em></li>
<li>Aconsejamos agregar una dependencia m&#xE1;s para las plataformas <em>ubuntu / debian</em>: <code>apt</code>

<ul>
<li>Analizar <a href="http://community.opscode.com/cookbooks/apt">cookbook apt</a></li>
</ul></li>
<li>Tenemos que instalar un mysql server:

<ul>
<li>Analizar <a href="http://community.opscode.com/cookbooks/mysql">cookbook mysql</a></li>
</ul></li>
<li>&#xBF;Qu&#xE9; recetas debemos indicar en el <code>runlist</code>? 

<ul>
<li>&#xA1;&#xA1;El orden es importante!!</li>
<li><code>apt</code>, <code>mysql::server</code>, <code>my_database</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/09_berkshelf/13">
<h1>El recipe para my_database</h1>

<pre class="sh_ruby"><code>db_super_connection = {
  :host =&gt; "localhost", 
  :username =&gt; 'root', 
  :password =&gt; node['mysql']['server_root_password']
}

mysql_database node[:my_database][:name] do
    connection db_super_connection
    action :create
end

mysql_database_user node[:my_database][:user] do
    connection db_super_connection
    password node[:my_database][:password]
    action [:create, :grant]
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets smaller" ref="01-chef-dev/09_berkshelf/14">
<h1>Como queda el Vagrantfile</h1>

<p>El <code>Vagrantfile</code> quedar&#xED;a:</p>

<pre class="sh_ruby"><code>Vagrant.configure("2") do |config|
    config.vm.hostname = "my-database-berkshelf"
    config.vm.box = "ubuntu-12.04.2-cespi-amd64"
    config.vm.box_url = "http://vagrantbox..."
    config.vm.network :private_network, ip: "33.33.33.10"
    config.ssh.max_tries = 40
    config.ssh.timeout   = 120
    config.berkshelf.enabled = true
    config.vm.provision :chef_solo do |chef|
        chef.json = {
            :mysql =&gt; {
                :server_root_password =&gt; 'rootpass',
                :server_debian_password =&gt; 'debpass',
                :server_repl_password =&gt; 'replpass'
            }
        }
        chef.run_list = [
                "recipe[apt]",
                "recipe[mysql::server]",
                "recipe[database::mysql]",
                "recipe[my_database::default]"
        ]
    end
end</code></pre>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content smbullets small" ref="01-chef-dev/09_berkshelf/15">
<h1>Nos faltan los atributos</h1>

<p>Editamos <code>attributes/default.rb</code></p>

<pre class="sh_ruby"><code>default[:my_database][:name] = "my_database"
default[:my_database][:user] = "my_user"
default[:my_database][:password] = "my_password"</code></pre>

<p>Y probamos el cookbook completo con: <code>vagrant up</code></p>
</div>
</div><div class="slide" data-transition="scrollVert"><div class="content center subsection" ref="02-chef-prod/01-intro">
<h1>TODO</h1>

<p class="notes">https://github.com/jonlives/knife-spork</p>
</div>
</div></div>
<div id="pauseScreen">
  
</div>

</body>
</html>
